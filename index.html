<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adrian Auctions - Plataforma de Subastas NFT</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üñºÔ∏è</text></svg>">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #3E63DD;
            --secondary-color: #6C757D;
            --success-color: #28A745;
            --danger-color: #DC3545;
            --bs-primary: #3E63DD;
        }
        
        body {
            padding-top: 56px;
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }
        
        .nav-link.active {
            color: var(--primary-color) !important;
            font-weight: 500;
        }
        
        .hero-section {
            background-color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .hero-section h1 {
            color: var(--primary-color);
        }
        
        .stats-section {
            background-color: var(--primary-color);
            color: white;
            padding: 3rem 0;
            margin: 2rem 0;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .stat-label {
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card {
            margin-bottom: 1.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: none;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .auction-img {
            height: 200px;
            object-fit: cover;
            background-color: #e9ecef;
        }
        
        .app-section {
            display: none;
        }
        
        .app-section.active {
            display: block;
        }
        
        .wallet-connect {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 0.5rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .time-left {
            font-size: 0.875rem;
            color: var(--bs-gray-600);
        }
        
        .ending-soon {
            color: var(--danger-color);
            font-weight: 500;
        }
        
        .footer {
            background-color: #343a40;
            color: white;
            padding: 3rem 0;
            margin-top: 3rem;
        }
        
        .footer a {
            color: rgba(255, 255, 255, 0.75);
            text-decoration: none;
        }
        
        .footer a:hover {
            color: white;
            text-decoration: underline;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            z-index: 1100;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        }
        
        .notification.info {
            background-color: var(--primary-color);
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .filter-buttons .btn {
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>

    <!-- Barra de navegaci√≥n -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#" data-section="home">Adrian Auctions</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="home">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="explore">Explorar</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="myauctions">Mis Subastas</a>
                    </li>
                </ul>
                <button id="connectWalletBtn" class="btn btn-outline-primary">Conectar Wallet</button>
            </div>
        </div>
    </nav>

    <main class="container py-4">
        <!-- Secci√≥n de inicio -->
        <section id="home-section" class="app-section active">
            <!-- Hero -->
            <div class="hero-section rounded">
                <h1 class="display-4">Bienvenido a Adrian Auctions</h1>
                <p class="lead text-muted mb-4">Plataforma de subastas NFT en la red Base. Conecta tu wallet, explora subastas activas y empieza a ofertar.</p>
                <div class="d-flex justify-content-center gap-3">
                    <button class="btn btn-primary btn-lg px-4" data-section="explore">Explorar Subastas</button>
                    <button class="btn btn-outline-primary btn-lg px-4" data-section="myauctions">Mis Subastas</button>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="stats-section rounded">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="stat-value" id="active-auctions-count">--</div>
                            <div class="stat-label">Subastas Activas</div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-value">125+</div>
                            <div class="stat-label">Usuarios</div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-value" id="total-auctions-count">--</div>
                            <div class="stat-label">NFTs Subastados</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- C√≥mo funciona -->
            <div class="py-5">
                <h2 class="text-center mb-4">¬øC√≥mo funciona?</h2>
                <div class="row">
                    <div class="col-md-4">
                        <div class="card h-100 p-4 text-center">
                            <div class="display-4 mb-3 text-primary">1</div>
                            <h3>Conecta tu wallet</h3>
                            <p class="text-muted">Compatible con MetaMask y otras wallets Web3. Conecta en la red Base con un solo clic.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 p-4 text-center">
                            <div class="display-4 mb-3 text-primary">2</div>
                            <h3>Explora subastas</h3>
                            <p class="text-muted">Navega por las subastas activas de NFTs y descubre piezas √∫nicas.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 p-4 text-center">
                            <div class="display-4 mb-3 text-primary">3</div>
                            <h3>Oferta y gana</h3>
                            <p class="text-muted">Participa en subastas haciendo ofertas con ETH y gana NFTs exclusivos.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n de explorar -->
        <section id="explore-section" class="app-section">
            <h1 class="mb-4">Explorar Subastas</h1>
            
            <!-- Estado sin conexi√≥n de wallet -->
            <div id="explore-wallet-connect" class="wallet-connect">
                <h3>Conecta tu wallet para ver subastas en tiempo real</h3>
                <p class="text-muted mb-4">Necesitas conectar tu wallet para ver las subastas activas y poder realizar ofertas.</p>
                <button class="btn btn-primary px-4 py-2" onclick="connectWallet()">Conectar wallet</button>
            </div>
            
            <!-- Mensaje de error -->
            <div id="explore-error" class="alert alert-danger" style="display: none;" role="alert">
                <p id="explore-error-message"></p>
                <button class="btn btn-sm btn-danger mt-2" onclick="loadExploreAuctions()">Reintentar</button>
            </div>
            
            <!-- Indicador de carga -->
            <div id="explore-loading" class="text-center py-5" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-3 text-muted">Cargando subastas...</p>
            </div>
            
            <!-- Mensaje de no hay subastas -->
            <div id="explore-empty" class="text-center py-5" style="display: none;">
                <div class="display-1 text-muted mb-3">¬Ø\_(„ÉÑ)_/¬Ø</div>
                <h3 class="text-muted">No hay subastas activas en este momento</h3>
                <p class="text-muted">Vuelve m√°s tarde para ver nuevas subastas</p>
            </div>
            
            <!-- Lista de subastas -->
            <div id="explore-auctions" class="row">
                <!-- Las subastas se cargar√°n din√°micamente aqu√≠ -->
            </div>
            
            <!-- Bot√≥n de cargar m√°s -->
            <div id="explore-load-more" class="text-center mt-4 mb-5" style="display: none;">
                <button id="load-more-btn" class="btn btn-outline-primary" onclick="handleLoadMoreAuctions()">
                    Cargar m√°s
                </button>
            </div>
        </section>

        <!-- Secci√≥n de mis subastas -->
        <section id="myauctions-section" class="app-section">
            <h1 class="mb-4">Mis Subastas</h1>
            
            <!-- Estado sin conexi√≥n de wallet -->
            <div id="myauctions-wallet-connect" class="wallet-connect">
                <h3>Conecta tu wallet para ver tus subastas</h3>
                <p class="text-muted mb-4">Conecta tu wallet para administrar tus subastas creadas y ver en cu√°les has participado.</p>
                <button class="btn btn-primary px-4 py-2" onclick="connectWallet()">Conectar wallet</button>
            </div>
            
            <!-- Mensaje de error -->
            <div id="myauctions-error" class="alert alert-danger" style="display: none;" role="alert">
                <p id="myauctions-error-message"></p>
                <button class="btn btn-sm btn-danger mt-2" onclick="loadMyAuctions()">Reintentar</button>
            </div>
            
            <!-- Indicador de carga -->
            <div id="myauctions-loading" class="text-center py-5" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-3 text-muted">Cargando tus subastas...</p>
            </div>
            
            <!-- Contenido cuando est√° conectado -->
            <div id="myauctions-content" style="display: none;">
                <!-- Pesta√±as -->
                <ul class="nav nav-tabs mb-4">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" id="created-tab" onclick="switchTab('created')">Mis Subastas Creadas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="bids-tab" onclick="switchTab('bids')">Mis Ofertas</a>
                    </li>
                </ul>
                
                <!-- Filtros -->
                <div class="filter-buttons mb-4">
                    <button class="btn btn-sm btn-primary filter-btn active" data-filter="all" onclick="filterMyAuctions('all')">Todas</button>
                    <button class="btn btn-sm btn-outline-primary filter-btn" data-filter="active" onclick="filterMyAuctions('active')">Activas</button>
                    <button class="btn btn-sm btn-outline-primary filter-btn" data-filter="ended" onclick="filterMyAuctions('ended')">Finalizadas</button>
                </div>
                
                <!-- Mensaje de no hay subastas creadas -->
                <div id="myauctions-created-empty" class="text-center py-5" style="display: none;">
                    <h3 class="text-muted" id="myauctions-created-empty-message">No has creado ninguna subasta todav√≠a</h3>
                </div>
                
                <!-- Lista de subastas creadas -->
                <div id="myauctions-created" class="row">
                    <!-- Las subastas se cargar√°n din√°micamente aqu√≠ -->
                </div>
                
                <!-- Mensaje de no hay ofertas -->
                <div id="myauctions-bids-empty" class="text-center py-5" style="display: none;">
                    <h3 class="text-muted" id="myauctions-bids-empty-message">No has realizado ofertas en ninguna subasta</h3>
                </div>
                
                <!-- Lista de subastas con ofertas -->
                <div id="myauctions-bids" class="row" style="display: none;">
                    <!-- Las subastas se cargar√°n din√°micamente aqu√≠ -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer mt-auto py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5>Adrian Auctions</h5>
                    <p>Plataforma de subastas NFT en la red Base.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Enlaces</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" data-section="home">Inicio</a></li>
                        <li><a href="#" data-section="explore">Explorar</a></li>
                        <li><a href="#" data-section="myauctions">Mis Subastas</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Informaci√≥n del contrato</h5>
                    <p>Direcci√≥n: 0xb502e19e62eE8D5Ee1F179b489d832EAb328Bc99</p>
                    <p>Red: Base Mainnet (Chain ID: 8453)</p>
                </div>
            </div>
            <div class="row">
                <div class="col-12 text-center">
                    <hr>
                    <p>¬© 2023 Adrian Auctions. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Modal para ofertas -->
    <div class="modal fade" id="bidModal" tabindex="-1" aria-labelledby="bidModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bidModalLabel">Realizar oferta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="bid-form">
                        <input type="hidden" id="auction-id">
                        <div class="mb-3">
                            <p>NFT #<span id="nft-id"></span></p>
                            <p>Precio m√≠nimo: <span id="reserve-price"></span> ETH</p>
                            <p>Oferta actual: <span id="current-bid"></span> ETH</p>
                        </div>
                        <div class="mb-3">
                            <label for="bid-amount" class="form-label">Cantidad a ofertar (ETH)</label>
                            <input type="number" class="form-control" id="bid-amount" step="0.01" min="0.01" required>
                            <div class="form-text">Introduce una cantidad mayor que la oferta actual.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="submit-bid">Confirmar oferta</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para cambiar de red -->
    <div class="modal fade" id="networkModal" tabindex="-1" aria-labelledby="networkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="networkModalLabel">Red incorrecta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Por favor cambia a la red Base Mainnet para interactuar con la aplicaci√≥n.</p>
                    <p>Red actual: <span id="current-network"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="switch-network">Cambiar a Base</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap Bundle con Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Ethers.js -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
    
    <script>
        // ABI del contrato
        const CONTRACT_ABI = [
            "function auctionCounter() view returns (uint256)",
            "function auctions(uint256) view returns (address nftContract, uint256 tokenId, address seller, uint256 reservePrice, uint256 endTime, address highestBidder, uint256 highestBid, bool active, bool finalized)",
            "function getActiveAuctions(uint256 page, uint256 pageSize) view returns (uint256[])",
            "function getActiveAuctionsCount() view returns (uint256)",
            "function getManyAuctionDetails(uint256[]) view returns (tuple(address nftContract, uint256 tokenId, address seller, uint256 reservePrice, uint256 endTime, address highestBidder, uint256 highestBid, bool active, bool finalized)[])",
            "function getUserAuctions(address) view returns (uint256[])",
            "function getUserBids(address) view returns (uint256[])",
            "function createAuction(address _nftContract, uint256 _tokenId, uint256 _reservePrice, uint256 _durationSecs)",
            "function placeBid(uint256 auctionId, uint256 amount)",
            "function endAuction(uint256 auctionId)",
            "function cancelAuction(uint256 auctionId)",
            "function relistAuction(uint256 auctionId, uint256 _newReservePrice, uint256 _durationSecs)",
            "function ADRIAN() view returns (address)"
        ];
        
        // Configuraci√≥n del contrato y red
        const CONTRACT_ADDRESS = '0xb502e19e62eE8D5Ee1F179b489d832EAb328Bc99';
        const BASE_CHAIN_ID = 8453;
        const BASE_CHAIN_HEX = '0x' + BASE_CHAIN_ID.toString(16);
        
        // Estado global de la aplicaci√≥n
        const appState = {
            // Estado de la wallet
            isConnected: false,
            address: null,
            signer: null,
            provider: null,
            contract: null,
            chainId: null,
            
            // Estado de la UI
            activeSection: 'home',
            activeTab: 'created',
            activeFilter: 'all',
            
            // Datos de subastas
            exploreAuctions: [],
            myAuctions: [],
            myBids: [],
            
            // Estado de paginaci√≥n
            explorePage: 0,
            exploreHasMore: true,
            
            // Contadores
            activeAuctionsCount: 0,
            totalAuctionsCount: 0
        };
        
        // Instancia de modales
        let bidModal;
        let networkModal;
        
        // Funciones de utilidad
        function formatAddress(address) {
            if (!address) return '';
            return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
        }
        
        function formatEther(wei) {
            try {
                if (!wei) return '0';
                return ethers.utils.formatEther(wei);
            } catch (error) {
                console.error('Error al formatear ether:', error);
                return '0';
            }
        }
        
        function parseEther(ether) {
            try {
                return ethers.utils.parseEther(ether.toString());
            } catch (error) {
                console.error('Error al parsear ether:', error);
                throw error;
            }
        }
        
        function getTimeLeft(endTime) {
            try {
                const now = Math.floor(Date.now() / 1000);
                const end = typeof endTime === 'object' ? endTime.toNumber() : parseInt(endTime);
                
                if (now >= end) {
                    return 'Finalizada';
                }
                
                const seconds = end - now;
                const days = Math.floor(seconds / 86400);
                const hours = Math.floor((seconds % 86400) / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                
                if (days > 0) {
                    return `${days}d ${hours}h`;
                } else if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m ${seconds % 60}s`;
                }
            } catch (error) {
                console.error('Error al calcular tiempo restante:', error);
                return 'Error';
            }
        }
        
        function isAuctionActive(auction) {
            try {
                const now = Math.floor(Date.now() / 1000);
                const endTime = typeof auction.endTime === 'object' 
                    ? auction.endTime.toNumber() 
                    : parseInt(auction.endTime);
                    
                return auction.active && !auction.finalized && endTime > now;
            } catch (error) {
                console.error('Error al comprobar si la subasta est√° activa:', error);
                return false;
            }
        }
        
        function isAuctionEnding(auction) {
            try {
                const now = Math.floor(Date.now() / 1000);
                const endTime = typeof auction.endTime === 'object' 
                    ? auction.endTime.toNumber() 
                    : parseInt(auction.endTime);
                const timeLeft = endTime - now;
                
                // Considerar como "terminando pronto" si quedan menos de 1 hora
                return timeLeft > 0 && timeLeft < 3600;
            } catch (error) {
                console.error('Error al comprobar si la subasta est√° terminando:', error);
                return false;
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Eliminar despu√©s de 3 segundos
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
        
        // Funciones de interfaz
        function navigateTo(section) {
            // Actualizar estado
            appState.activeSection = section;
            
            // Actualizar clases activas en la navegaci√≥n
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === section) {
                    link.classList.add('active');
                }
            });
            
            // Ocultar todas las secciones
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById(`${section}-section`).classList.add('active');
            
            // Cargar datos seg√∫n la secci√≥n
            if (section === 'explore' && appState.isConnected) {
                loadExploreAuctions();
            } else if (section === 'myauctions' && appState.isConnected) {
                loadMyAuctions();
            } else if (section === 'home') {
                loadHomeStats();
            }
        }
        
        function switchTab(tab) {
            appState.activeTab = tab;
            
            // Actualizar clases activas en las pesta√±as
            document.querySelectorAll('.nav-tabs .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`).classList.add('active');
            
            // Mostrar el contenido de la pesta√±a seleccionada
            if (tab === 'created') {
                document.getElementById('myauctions-created').style.display = 'flex';
                document.getElementById('myauctions-bids').style.display = 'none';
                
                // Mostrar mensaje vac√≠o apropiado
                const isEmpty = document.getElementById('myauctions-created').children.length === 0;
                document.getElementById('myauctions-created-empty').style.display = isEmpty ? 'block' : 'none';
                document.getElementById('myauctions-bids-empty').style.display = 'none';
            } else {
                document.getElementById('myauctions-created').style.display = 'none';
                document.getElementById('myauctions-bids').style.display = 'flex';
                
                // Mostrar mensaje vac√≠o apropiado
                const isEmpty = document.getElementById('myauctions-bids').children.length === 0;
                document.getElementById('myauctions-bids-empty').style.display = isEmpty ? 'block' : 'none';
                document.getElementById('myauctions-created-empty').style.display = 'none';
            }
            
            filterMyAuctions(appState.activeFilter);
        }
        
        function filterMyAuctions(filter) {
            appState.activeFilter = filter;
            
            // Actualizar clases activas en los botones de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'btn-primary');
                btn.classList.add('btn-outline-primary');
                
                if (btn.getAttribute('data-filter') === filter) {
                    btn.classList.add('active', 'btn-primary');
                    btn.classList.remove('btn-outline-primary');
                }
            });
            
            // Aplicar filtro a las subastas mostradas
            const auctionsContainer = appState.activeTab === 'created' 
                ? document.getElementById('myauctions-created')
                : document.getElementById('myauctions-bids');
                
            const emptyContainer = appState.activeTab === 'created'
                ? document.getElementById('myauctions-created-empty')
                : document.getElementById('myauctions-bids-empty');
                
            const emptyMessage = appState.activeTab === 'created'
                ? document.getElementById('myauctions-created-empty-message')
                : document.getElementById('myauctions-bids-empty-message');
            
            // Filtrar subastas
            const auctionCards = auctionsContainer.querySelectorAll('.col-md-4');
            let visibleCount = 0;
            
            auctionCards.forEach(card => {
                const auction = card.querySelector('.card');
                const isActive = auction.getAttribute('data-active') === 'true';
                const isFinalized = auction.getAttribute('data-finalized') === 'true';
                const endTime = parseInt(auction.getAttribute('data-endtime'));
                const now = Math.floor(Date.now() / 1000);
                
                let shouldShow = true;
                
                if (filter === 'active') {
                    shouldShow = isActive && !isFinalized && endTime > now;
                } else if (filter === 'ended') {
                    shouldShow = !isActive || isFinalized || endTime <= now;
                }
                
                card.style.display = shouldShow ? 'block' : 'none';
                if (shouldShow) visibleCount++;
            });
            
            // Actualizar mensaje vac√≠o
            if (visibleCount === 0) {
                const allAuctions = appState.activeTab === 'created' ? appState.myAuctions : appState.myBids;
                
                if (allAuctions.length === 0) {
                    emptyMessage.textContent = appState.activeTab === 'created'
                        ? 'No has creado ninguna subasta todav√≠a'
                        : 'No has realizado ofertas en ninguna subasta';
                } else {
                    const filterText = filter === 'active' ? 'activas' : filter === 'ended' ? 'finalizadas' : '';
                    emptyMessage.textContent = `No hay subastas ${filterText}`;
                }
                
                emptyContainer.style.display = 'block';
            } else {
                emptyContainer.style.display = 'none';
            }
        }
        
        function updateUIForConnectedWallet() {
            // Actualizar bot√≥n de conexi√≥n
            const connectButton = document.getElementById('connectWalletBtn');
            connectButton.textContent = formatAddress(appState.address);
            connectButton.classList.remove('btn-outline-primary');
            connectButton.classList.add('btn-secondary');
            
            // Ocultar los contenedores de conexi√≥n
            document.getElementById('explore-wallet-connect').style.display = 'none';
            document.getElementById('myauctions-wallet-connect').style.display = 'none';
            
            // Mostrar contenido de mis subastas
            document.getElementById('myauctions-content').style.display = 'block';
            
            // Cargar datos para la secci√≥n actual
            if (appState.activeSection === 'explore') {
                loadExploreAuctions();
            } else if (appState.activeSection === 'myauctions') {
                loadMyAuctions();
            }
            
            // Cargar estad√≠sticas para la p√°gina de inicio
            loadHomeStats();
        }
        
        function updateUIForDisconnectedWallet() {
            // Actualizar bot√≥n de conexi√≥n
            const connectButton = document.getElementById('connectWalletBtn');
            connectButton.textContent = 'Conectar Wallet';
            connectButton.classList.remove('btn-secondary');
            connectButton.classList.add('btn-outline-primary');
            
            // Mostrar los contenedores de conexi√≥n
            document.getElementById('explore-wallet-connect').style.display = 'block';
            document.getElementById('myauctions-wallet-connect').style.display = 'block';
            
            // Ocultar contenido de mis subastas
            document.getElementById('myauctions-content').style.display = 'none';
            
            // Actualizar estad√≠sticas en la p√°gina de inicio
            document.getElementById('active-auctions-count').textContent = '--';
            document.getElementById('total-auctions-count').textContent = '--';
        }
        
        // Funciones de conexi√≥n con blockchain
        async function initContract() {
            try {
                if (appState.isConnected && appState.signer) {
                    // Usar signer para transacciones
                    appState.contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, appState.signer);
                } else {
                    // Usar provider para lecturas
                    const provider = new ethers.providers.JsonRpcProvider('https://mainnet.base.org');
                    appState.provider = provider;
                    appState.contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);
                }
                return true;
            } catch (error) {
                console.error('Error al inicializar contrato:', error);
                showNotification('Error al conectar con el contrato', 'error');
                return false;
            }
        }
        
        async function connectWallet() {
            try {
                // Verificar si MetaMask est√° instalado
                if (typeof window.ethereum === 'undefined') {
                    showNotification('Por favor instala MetaMask para conectar tu wallet', 'error');
                    return false;
                }
                
                // Solicitar conexi√≥n de cuentas
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                if (accounts.length === 0) {
                    showNotification('No se pudo conectar a MetaMask', 'error');
                    return false;
                }
                
                // Verificar red
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                appState.chainId = chainId;
                
                // Actualizar estado
                appState.address = accounts[0];
                appState.isConnected = true;
                
                // Crear provider y signer
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                appState.provider = provider;
                appState.signer = provider.getSigner();
                
                // Actualizar UI
                updateUIForConnectedWallet();
                
                // Inicializar contrato
                await initContract();
                
                showNotification('Wallet conectada con √©xito', 'success');
                
                // Verificar si estamos en la red correcta
                if (chainId !== BASE_CHAIN_HEX) {
                    promptSwitchNetwork();
                }
                
                // Configurar listener para cambio de cuentas
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                
                // Configurar listener para cambio de red
                window.ethereum.on('chainChanged', handleChainChanged);
                
                return true;
            } catch (error) {
                console.error('Error al conectar wallet:', error);
                showNotification('Error al conectar la wallet', 'error');
                return false;
            }
        }
        
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                // Usuario desconect√≥ su wallet
                appState.isConnected = false;
                appState.address = null;
                appState.signer = null;
                updateUIForDisconnectedWallet();
                showNotification('Wallet desconectada', 'info');
            } else if (accounts[0] !== appState.address) {
                // Usuario cambi√≥ de cuenta
                appState.address = accounts[0];
                
                // Actualizar signer
                if (appState.provider) {
                    appState.signer = appState.provider.getSigner();
                    initContract();
                }
                
                // Actualizar UI
                updateUIForConnectedWallet();
                showNotification('Cuenta cambiada: ' + formatAddress(accounts[0]), 'info');
            }
        }
        
        function handleChainChanged(chainId) {
            appState.chainId = chainId;
            
            if (chainId !== BASE_CHAIN_HEX) {
                showNotification('Red incorrecta. Por favor, cambia a Base Mainnet', 'warning');
                promptSwitchNetwork();
            } else {
                showNotification('Conectado a la red Base', 'success');
                
                // Refrescar datos
                if (appState.activeSection === 'explore') {
                    loadExploreAuctions();
                } else if (appState.activeSection === 'myauctions') {
                    loadMyAuctions();
                } else if (appState.activeSection === 'home') {
                    loadHomeStats();
                }
            }
        }
        
        function promptSwitchNetwork() {
            document.getElementById('current-network').textContent = appState.chainId || 'Desconocida';
            networkModal.show();
        }
        
        async function switchToBaseNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: BASE_CHAIN_HEX }]
                });
                networkModal.hide();
                return true;
            } catch (error) {
                // Si la red no est√° configurada, intentar a√±adirla
                if (error.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: BASE_CHAIN_HEX,
                                chainName: 'Base Mainnet',
                                nativeCurrency: {
                                    name: 'ETH',
                                    symbol: 'ETH',
                                    decimals: 18
                                },
                                rpcUrls: ['https://mainnet.base.org'],
                                blockExplorerUrls: ['https://basescan.org']
                            }]
                        });
                        networkModal.hide();
                        return true;
                    } catch (addError) {
                        console.error('Error al a√±adir la red Base:', addError);
                        showNotification('Error al a√±adir la red Base', 'error');
                        return false;
                    }
                }
                
                console.error('Error al cambiar a la red Base:', error);
                showNotification('Error al cambiar de red', 'error');
                return false;
            }
        }
        
        // Funciones para cargar datos
        async function loadHomeStats() {
            try {
                // Inicializar contrato si es necesario
                if (!appState.contract) {
                    const success = await initContract();
                    if (!success) return;
                }
                
                // Obtener contadores
                const activeCount = await appState.contract.getActiveAuctionsCount();
                const totalCount = await appState.contract.auctionCounter();
                
                // Actualizar estado
                appState.activeAuctionsCount = activeCount.toNumber();
                appState.totalAuctionsCount = totalCount.toNumber();
                
                // Actualizar UI
                document.getElementById('active-auctions-count').textContent = appState.activeAuctionsCount;
                document.getElementById('total-auctions-count').textContent = appState.totalAuctionsCount;
            } catch (error) {
                console.error('Error al cargar estad√≠sticas:', error);
                showNotification('Error al cargar estad√≠sticas', 'error');
            }
        }
        
        async function loadExploreAuctions(resetPage = true) {
            try {
                // Mostrar estado de carga
                document.getElementById('explore-loading').style.display = 'block';
                document.getElementById('explore-error').style.display = 'none';
                document.getElementById('explore-empty').style.display = 'none';
                
                if (resetPage) {
                    document.getElementById('explore-auctions').innerHTML = '';
                    appState.explorePage = 0;
                    appState.exploreHasMore = true;
                }
                
                // Verificar conexi√≥n al contrato
                if (!appState.contract) {
                    const success = await initContract();
                    if (!success) {
                        document.getElementById('explore-loading').style.display = 'none';
                        document.getElementById('explore-error').style.display = 'block';
                        document.getElementById('explore-error-message').textContent = 'No se pudo conectar con el contrato';
                        return;
                    }
                }
                
                // Obtener IDs de subastas activas
                const pageSize = 12;
                const auctionIds = await appState.contract.getActiveAuctions(appState.explorePage, pageSize);
                
                // Si no hay resultados
                if (auctionIds.length === 0) {
                    appState.exploreHasMore = false;
                    
                    // Si es la primera p√°gina y no hay subastas
                    if (appState.explorePage === 0 && document.getElementById('explore-auctions').children.length === 0) {
                        document.getElementById('explore-empty').style.display = 'block';
                    }
                    
                    document.getElementById('explore-loading').style.display = 'none';
                    document.getElementById('explore-load-more').style.display = 'none';
                    return;
                }
                
                // Obtener detalles de las subastas
                const auctionDetails = await appState.contract.getManyAuctionDetails(auctionIds);
                
                // Filtrar subastas inv√°lidas
                const validAuctions = auctionDetails.filter(auction => 
                    auction && auction.nftContract && auction.tokenId
                );
                
                // Actualizar estado
                if (resetPage) {
                    appState.exploreAuctions = validAuctions;
                } else {
                    appState.exploreAuctions = [...appState.exploreAuctions, ...validAuctions];
                }
                
                appState.explorePage++;
                
                // Renderizar subastas
                const auctionsContainer = document.getElementById('explore-auctions');
                
                validAuctions.forEach((auction, index) => {
                    const auctionElement = createAuctionCard(auction, auctionIds[index]);
                    auctionsContainer.appendChild(auctionElement);
                });
                
                // Actualizar UI
                document.getElementById('explore-loading').style.display = 'none';
                document.getElementById('explore-load-more').style.display = appState.exploreHasMore ? 'block' : 'none';
                
                // Mostrar mensaje vac√≠o si no hay subastas
                if (document.getElementById('explore-auctions').children.length === 0) {
                    document.getElementById('explore-empty').style.display = 'block';
                } else {
                    document.getElementById('explore-empty').style.display = 'none';
                }
            } catch (error) {
                console.error('Error al cargar subastas:', error);
                document.getElementById('explore-loading').style.display = 'none';
                document.getElementById('explore-error').style.display = 'block';
                document.getElementById('explore-error-message').textContent = `Error al cargar subastas: ${error.message || 'Error desconocido'}`;
            }
        }
        
        function handleLoadMoreAuctions() {
            if (appState.exploreHasMore) {
                loadExploreAuctions(false);
            }
        }
        
        async function loadMyAuctions() {
            try {
                // Verificar si est√° conectado
                if (!appState.isConnected || !appState.address) {
                    return;
                }
                
                // Mostrar estado de carga
                document.getElementById('myauctions-loading').style.display = 'block';
                document.getElementById('myauctions-error').style.display = 'none';
                document.getElementById('myauctions-content').style.display = 'none';
                
                // Verificar conexi√≥n al contrato
                if (!appState.contract) {
                    const success = await initContract();
                    if (!success) {
                        document.getElementById('myauctions-loading').style.display = 'none';
                        document.getElementById('myauctions-error').style.display = 'block';
                        document.getElementById('myauctions-error-message').textContent = 'No se pudo conectar con el contrato';
                        return;
                    }
                }
                
                // Obtener IDs de subastas creadas por el usuario
                const createdAuctionIds = await appState.contract.getUserAuctions(appState.address);
                
                // Obtener IDs de subastas en las que el usuario ha ofertado
                const bidAuctionIds = await appState.contract.getUserBids(appState.address);
                
                // Obtener detalles de las subastas
                let createdAuctions = [];
                let bidAuctions = [];
                
                if (createdAuctionIds.length > 0) {
                    const auctionDetails = await appState.contract.getManyAuctionDetails(createdAuctionIds);
                    createdAuctions = auctionDetails.filter(auction => 
                        auction && auction.nftContract && auction.tokenId
                    );
                }
                
                if (bidAuctionIds.length > 0) {
                    const auctionDetails = await appState.contract.getManyAuctionDetails(bidAuctionIds);
                    bidAuctions = auctionDetails.filter(auction => 
                        auction && auction.nftContract && auction.tokenId
                    );
                }
                
                // Actualizar estado
                appState.myAuctions = createdAuctions;
                appState.myBids = bidAuctions;
                
                // Renderizar subastas
                const createdContainer = document.getElementById('myauctions-created');
                const bidsContainer = document.getElementById('myauctions-bids');
                
                // Limpiar contenedores
                createdContainer.innerHTML = '';
                bidsContainer.innerHTML = '';
                
                // Renderizar subastas creadas
                createdAuctions.forEach((auction, index) => {
                    const auctionElement = createAuctionCard(auction, createdAuctionIds[index], true);
                    createdContainer.appendChild(auctionElement);
                });
                
                // Renderizar subastas con ofertas
                bidAuctions.forEach((auction, index) => {
                    const auctionElement = createAuctionCard(auction, bidAuctionIds[index], true);
                    bidsContainer.appendChild(auctionElement);
                });
                
                // Actualizar UI
                document.getElementById('myauctions-loading').style.display = 'none';
                document.getElementById('myauctions-content').style.display = 'block';
                
                // Mostrar/ocultar mensajes vac√≠os
                document.getElementById('myauctions-created-empty').style.display = 
                    createdAuctions.length === 0 ? 'block' : 'none';
                document.getElementById('myauctions-bids-empty').style.display = 
                    bidAuctions.length === 0 ? 'block' : 'none';
                
                // Asegurar que se muestra la pesta√±a activa
                switchTab(appState.activeTab);
                
                // Aplicar filtro activo
                filterMyAuctions(appState.activeFilter);
            } catch (error) {
                console.error('Error al cargar mis subastas:', error);
                document.getElementById('myauctions-loading').style.display = 'none';
                document.getElementById('myauctions-error').style.display = 'block';
                document.getElementById('myauctions-error-message').textContent = `Error al cargar tus subastas: ${error.message || 'Error desconocido'}`;
            }
        }
        
        // Funciones para renderizar subastas
        function createAuctionCard(auction, auctionId, showActions = true) {
            // Crear columna
            const column = document.createElement('div');
            column.className = 'col-md-4 mb-4';
            
            // Obtener datos de la subasta
            const tokenId = auction.tokenId.toString();
            const seller = auction.seller;
            const reservePrice = formatEther(auction.reservePrice);
            const highestBid = formatEther(auction.highestBid);
            const highestBidder = auction.highestBidder;
            const endTime = typeof auction.endTime === 'object' ? auction.endTime.toNumber() : parseInt(auction.endTime);
            const isActive = auction.active;
            const isFinalized = auction.finalized;
            
            // Calcular estados adicionales
            const timeLeft = getTimeLeft(endTime);
            const isEnding = isAuctionEnding(auction);
            const now = Math.floor(Date.now() / 1000);
            const hasEnded = now >= endTime;
            const isOwner = appState.address && seller.toLowerCase() === appState.address.toLowerCase();
            const isHighestBidder = appState.address && highestBidder.toLowerCase() === appState.address.toLowerCase();
            const hasReserveBeenMet = parseFloat(highestBid) >= parseFloat(reservePrice);
            
            // Crear tarjeta
            column.innerHTML = `
                <div class="card h-100" 
                    data-auction-id="${auctionId}"
                    data-token-id="${tokenId}"
                    data-seller="${seller}"
                    data-reserve="${reservePrice}"
                    data-bid="${highestBid}"
                    data-bidder="${highestBidder}"
                    data-endtime="${endTime}"
                    data-active="${isActive}"
                    data-finalized="${isFinalized}">
                    
                    <img src="https://via.placeholder.com/400x200?text=NFT+${tokenId}" class="card-img-top auction-img" alt="NFT Image">
                    
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">NFT #${tokenId}</h5>
                        <p class="card-text">Precio m√≠nimo: ${reservePrice} ETH</p>
                        <p class="card-text">Oferta actual: ${highestBid} ETH</p>
                        <p class="card-text">Vendedor: ${formatAddress(seller)}</p>
                        <p class="card-text">
                            <small class="time-left ${isEnding ? 'ending-soon' : ''}">${timeLeft}</small>
                        </p>
                        
                        ${showActions ? `
                            <div class="mt-auto">
                                ${isActive && !isFinalized && !hasEnded && !isOwner ? `
                                    <button class="btn btn-primary w-100 bid-button" data-auction-id="${auctionId}">Ofertar</button>
                                ` : ''}
                                
                                ${isOwner && hasEnded && !isFinalized && hasReserveBeenMet ? `
                                    <button class="btn btn-success w-100 end-auction-button" data-auction-id="${auctionId}">Finalizar Subasta</button>
                                ` : ''}
                                
                                ${isHighestBidder && hasEnded && !isFinalized && hasReserveBeenMet ? `
                                    <button class="btn btn-info w-100 claim-nft-button" data-auction-id="${auctionId}">Reclamar NFT</button>
                                ` : ''}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // A√±adir eventos a los botones
            if (showActions) {
                const bidButton = column.querySelector('.bid-button');
                if (bidButton) {
                    bidButton.addEventListener('click', () => showBidModal(auction, auctionId));
                }
                
                const endAuctionButton = column.querySelector('.end-auction-button');
                if (endAuctionButton) {
                    endAuctionButton.addEventListener('click', () => endAuction(auctionId));
                }
                
                const claimNFTButton = column.querySelector('.claim-nft-button');
                if (claimNFTButton) {
                    claimNFTButton.addEventListener('click', () => claimNFT(auctionId));
                }
            }
            
            return column;
        }
        
        // Funciones para acciones de subastas
        function showBidModal(auction, auctionId) {
            // Rellenar datos del modal
            document.getElementById('auction-id').value = auctionId;
            document.getElementById('nft-id').textContent = auction.tokenId.toString();
            document.getElementById('reserve-price').textContent = formatEther(auction.reservePrice);
            document.getElementById('current-bid').textContent = formatEther(auction.highestBid);
            
            // Establecer valor m√≠nimo para la oferta
            const minBid = Math.max(
                parseFloat(formatEther(auction.reservePrice)),
                parseFloat(formatEther(auction.highestBid)) + 0.01
            ).toFixed(2);
            
            document.getElementById('bid-amount').min = minBid;
            document.getElementById('bid-amount').value = minBid;
            
            // Mostrar modal
            bidModal.show();
        }
        
        async function submitBid() {
            try {
                // Verificar si est√° conectado
                if (!appState.isConnected || !appState.signer) {
                    showNotification('Por favor conecta tu wallet', 'error');
                    bidModal.hide();
                    return;
                }
                
                // Obtener datos del formulario
                const auctionId = document.getElementById('auction-id').value;
                const bidAmount = document.getElementById('bid-amount').value;
                
                // Validar monto
                if (!bidAmount || parseFloat(bidAmount) <= 0) {
                    showNotification('Por favor introduce un monto v√°lido', 'error');
                    return;
                }
                
                // Cerrar modal
                bidModal.hide();
                
                // Mostrar notificaci√≥n de espera
                showNotification('Procesando la oferta, confirma la transacci√≥n en tu wallet...', 'info');
                
                // Enviar transacci√≥n
                const bidAmountWei = parseEther(bidAmount);
                const tx = await appState.contract.placeBid(auctionId, bidAmountWei);
                
                // Esperar confirmaci√≥n
                showNotification('Transacci√≥n enviada, esperando confirmaci√≥n...', 'info');
                await tx.wait();
                
                // Mostrar √©xito
                showNotification('¬°Oferta realizada con √©xito!', 'success');
                
                // Recargar datos
                if (appState.activeSection === 'explore') {
                    loadExploreAuctions();
                } else if (appState.activeSection === 'myauctions') {
                    loadMyAuctions();
                }
            } catch (error) {
                console.error('Error al realizar oferta:', error);
                showNotification(`Error: ${error.message || 'Hubo un problema al hacer la oferta'}`, 'error');
            }
        }
        
        async function endAuction(auctionId) {
            try {
                // Verificar si est√° conectado
                if (!appState.isConnected || !appState.signer) {
                    showNotification('Por favor conecta tu wallet', 'error');
                    return;
                }
                
                // Confirmar acci√≥n
                if (!confirm('¬øEst√°s seguro de que deseas finalizar esta subasta?')) {
                    return;
                }
                
                // Mostrar notificaci√≥n de espera
                showNotification('Procesando la finalizaci√≥n, confirma la transacci√≥n en tu wallet...', 'info');
                
                // Enviar transacci√≥n
                const tx = await appState.contract.endAuction(auctionId);
                
                // Esperar confirmaci√≥n
                showNotification('Transacci√≥n enviada, esperando confirmaci√≥n...', 'info');
                await tx.wait();
                
                // Mostrar √©xito
                showNotification('¬°Subasta finalizada con √©xito!', 'success');
                
                // Recargar datos
                if (appState.activeSection === 'explore') {
                    loadExploreAuctions();
                } else if (appState.activeSection === 'myauctions') {
                    loadMyAuctions();
                }
            } catch (error) {
                console.error('Error al finalizar subasta:', error);
                showNotification(`Error: ${error.message || 'Hubo un problema al finalizar la subasta'}`, 'error');
            }
        }
        
        async function claimNFT(auctionId) {
            try {
                // Verificar si est√° conectado
                if (!appState.isConnected || !appState.signer) {
                    showNotification('Por favor conecta tu wallet', 'error');
                    return;
                }
                
                // Confirmar acci√≥n
                if (!confirm('¬øEst√°s seguro de que deseas reclamar este NFT?')) {
                    return;
                }
                
                // Mostrar notificaci√≥n de espera
                showNotification('Procesando la reclamaci√≥n, confirma la transacci√≥n en tu wallet...', 'info');
                
                // Enviar transacci√≥n (endAuction tambi√©n funciona para reclamar)
                const tx = await appState.contract.endAuction(auctionId);
                
                // Esperar confirmaci√≥n
                showNotification('Transacci√≥n enviada, esperando confirmaci√≥n...', 'info');
                await tx.wait();
                
                // Mostrar √©xito
                showNotification('¬°NFT reclamado con √©xito!', 'success');
                
                // Recargar datos
                if (appState.activeSection === 'explore') {
                    loadExploreAuctions();
                } else if (appState.activeSection === 'myauctions') {
                    loadMyAuctions();
                }
            } catch (error) {
                console.error('Error al reclamar NFT:', error);
                showNotification(`Error: ${error.message || 'Hubo un problema al reclamar el NFT'}`, 'error');
            }
        }
        
        // Inicializaci√≥n y eventos
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar modales de Bootstrap
            bidModal = new bootstrap.Modal(document.getElementById('bidModal'));
            networkModal = new bootstrap.Modal(document.getElementById('networkModal'));
            
            // Eventos para navegaci√≥n
            document.querySelectorAll('[data-section]').forEach(element => {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = element.getAttribute('data-section');
                    navigateTo(section);
                });
            });
            
            // Evento para conectar wallet
            document.getElementById('connectWalletBtn').addEventListener('click', async () => {
                if (!appState.isConnected) {
                    await connectWallet();
                }
            });
            
            // Evento para cambiar de red
            document.getElementById('switch-network').addEventListener('click', switchToBaseNetwork);
            
            // Evento para enviar oferta
            document.getElementById('submit-bid').addEventListener('click', submitBid);
            
            // Verificar si ya hay una wallet conectada (para reconexi√≥n autom√°tica)
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            // Hay una wallet ya conectada
                            connectWallet();
                        }
                    })
                    .catch(error => console.error('Error al verificar cuentas:', error));
            }
            
            // Inicializar contrato para lecturas
            initContract().then(() => {
                // Cargar estad√≠sticas iniciales
                loadHomeStats();
                
                // Actualizar peri√≥dicamente los datos
                setInterval(() => {
                    if (appState.activeSection === 'explore' && appState.isConnected) {
                        loadExploreAuctions();
                    } else if (appState.activeSection === 'home') {
                        loadHomeStats();
                    }
                }, 60000); // Cada minuto
            });
            
            // Inicializar UI seg√∫n secci√≥n actual en la URL
            const hash = window.location.hash.replace('#', '');
            if (hash && ['home', 'explore', 'myauctions'].includes(hash)) {
                navigateTo(hash);
            } else {
                navigateTo('home');
            }
        });
    </script>
</body>
</html> 