<!-- File 1: index.html (PART 1) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adrian Auction</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script defer src="auction.js"></script>
  <style>
    :root {
      --bg-color: #f0f0f0;
      --primary-text: #333333;
      --card-bg: #ffffff;
      --card-border: #e9ecef;
      --success-bg: #d4edda;
      --success-text: #155724;
      --error-bg: #f8d7da;
      --error-text: #721c24;
    }
    body {
      background-color: var(--bg-color);
      color: var(--primary-text);
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.5rem;
    }
    .badge {
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4 text-center">Adrian Auction DApp</h1>
    <div class="text-center mb-4">
      <button id="connectBtn" class="btn btn-primary">Connect Wallet</button>
      <p id="walletAddress" class="mt-2"></p>
    </div>
    <div class="text-center mb-3">
      <select id="filterSelect" class="form-select w-auto d-inline-block">
        <option value="all">All Auctions</option>
        <option value="active">Only Active</option>
        <option value="reserveMet">Reserve Met</option>
        <option value="endingSoon">Ending Soon</option>
      </select>
      <button class="btn btn-outline-dark ms-2" onclick="loadActiveAuctions()">Apply Filter</button>
    </div>
    <div id="auctionsList" class="row mt-4">
      <!-- Rendered dynamically by auction.js -->
    </div>
  </div>

<script>
  let currentAccount = null;

  document.getElementById("connectBtn").addEventListener("click", async () => {
    if (window.ethereum) {
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        currentAccount = accounts[0];
        document.getElementById("walletAddress").innerText = `Connected: ${currentAccount.slice(0,6)}...${currentAccount.slice(-4)}`;
        await loadActiveAuctions();
      } catch (err) {
        console.error("User denied wallet connection");
      }
    } else {
      alert("MetaMask not detected!");
    }
  });

  async function loadActiveAuctions() {
    const readContract = new ethers.Contract("0xb502e19e62eE8D5Ee1F179b489d832EAb328Bc99", [
      "function getActiveAuctionsCount() view returns (uint256)",
      "function getActiveAuctions(uint256,uint256) view returns (uint256[] memory)",
      "function getManyAuctionDetails(uint256[]) view returns ((address,uint256,address,uint256,uint256,address,uint256,bool,bool)[] memory)"
    ], new ethers.providers.JsonRpcProvider("https://base-mainnet.infura.io/v3/cc0c8013b1e044dcba79d4f7ec3b2ba1"));

    const count = await readContract.getActiveAuctionsCount();
    const pages = Math.ceil(count / 50);
    let allIds = [];

    for (let i = 0; i < pages; i++) {
      const ids = await readContract.getActiveAuctions(i, 50);
      allIds = allIds.concat(ids);
    }

    const details = await readContract.getManyAuctionDetails(allIds);
    const filter = document.getElementById("filterSelect").value;

    const now = Math.floor(Date.now() / 1000);
    const filtered = details.filter((a) => {
      const timeLeft = a.endTime - now;
      if (filter === "active") return a.active;
      if (filter === "reserveMet") return a.highestBid >= a.reservePrice;
      if (filter === "endingSoon") return a.active && timeLeft < 900;
      return true;
    });

    filtered.sort((a, b) => a.endTime - b.endTime);

    const container = document.getElementById("auctionsList");
    container.innerHTML = "";

    filtered.forEach((a, index) => {
      const timeRemaining = a.endTime - now;
      const endsSoon = a.active && timeRemaining < 900;
      const passedReserve = a.highestBid >= a.reservePrice;

      const cardClass = `card text-dark ${endsSoon ? 'border-warning bg-warning-subtle' : ''} ${passedReserve ? 'border-success bg-success-subtle' : ''}`.trim();
      const statusTag = `
        ${endsSoon ? '<span class="badge bg-warning text-dark me-1">ðŸ”¥ Ending Soon</span>' : ''}
        ${passedReserve ? '<span class="badge bg-success text-white">âœ… Reserve Met</span>' : ''}
      `;

      const html = `
        <div class="col-md-4 mb-3">
          <div class="${cardClass}">
            <div class="card-body">
              <h5 class="card-title">Auction</h5>
              <p>${statusTag}</p>
              <p>NFT: ${a.nftContract}</p>
              <p>Token ID: ${a.tokenId}</p>
              <p>Seller: ${a.seller}</p>
              <p>Reserve: ${ethers.utils.formatUnits(a.reservePrice, 18)} ADRIAN</p>
              <p>Highest Bid: ${ethers.utils.formatUnits(a.highestBid, 18)} ADRIAN</p>
              <p>Ends: ${new Date(a.endTime * 1000).toLocaleString()}</p>
              <p>Status: ${a.active ? "Active" : "Inactive"} ${a.finalized ? "(Finalized)" : ""}</p>
            </div>
          </div>
        </div>`;
      container.innerHTML += html;
    });
  }
</script>
</body>
</html>
